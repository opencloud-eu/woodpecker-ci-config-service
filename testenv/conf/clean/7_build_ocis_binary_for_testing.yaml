steps:
  - image: owncloudci/drone-skip-pipeline
    name: skip-if-unchanged
    settings:
      ALLOW_SKIP_CHANGED:
        - ^.github/.*
        - ^.vscode/.*
        - ^changelog/.*
        - ^docs/.*
        - ^deployments/.*
        - CHANGELOG.md
        - CONTRIBUTING.md
        - LICENSE
        - README.md
        - .*_test.go$
    when:
      event:
        - pull_request
  - commands:
      - pnpm config set store-dir ./.pnpm-store
      - retry -t 3 'make ci-node-generate'
    environment:
      CHROMEDRIVER_SKIP_DOWNLOAD: "true"
    image: owncloudci/nodejs:20
    name: generate nodejs
  - commands:
      - retry -t 3 'make ci-go-generate'
    environment:
      HTTP_PROXY:
        from_secret: drone_http_proxy
      HTTPS_PROXY:
        from_secret: drone_http_proxy
    image: owncloudci/golang:1.22
    name: generate go
when:
  - evaluate: 'ENV_WORKFLOW_SKIP_7_BUILD_OCIS_BINARY_FOR_TESTING != "true"' # TODO
