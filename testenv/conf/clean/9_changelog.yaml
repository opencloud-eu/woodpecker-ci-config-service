steps:
  - commands:
      - make -C ocis changelog
    environment:
      HTTP_PROXY:
        from_secret: drone_http_proxy
      HTTPS_PROXY:
        from_secret: drone_http_proxy
    image: owncloudci/golang:1.22
    name: generate
  - commands:
      - git diff
    image: owncloudci/alpine:latest
    name: diff
  - commands:
      - cat CHANGELOG.md
    image: owncloudci/alpine:latest
    name: output
  - image: quay.io/thegeeklab/wp-git-action
    name: publish
    settings:
      action:
        - commit
        - push
      author_email: devops@opencloud-eu.com
      author_name: openClouders
      branch: master
      message: Automated changelog update [skip ci]
      netrc_machine: github.com
      netrc_password:
        from_secret: github_token
      netrc_username:
        from_secret: github_username
    when:
      - branch:
        include: [main, release/*]
        exclude: [refs/pull/**]
when:
  - evaluate: 'ENV_WORKFLOW_SKIP_9_CHANGELOG != "true"' # TODO
